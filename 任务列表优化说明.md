# 任务列表优化说明 - 添加设计文档引用

## 优化内容

为 `tasks.md` 中的每个任务添加了对 `design.md` 的具体章节引用，使开发人员能够快速找到详细的实现指导。

## 引用格式

每个任务现在包含两行引用：

```markdown
- [ ] X. 任务名称
  - 任务详细描述
  - _Requirements: X.X, X.X_  ← 链接到需求文档
  - _Design: 章节名 > 子章节名（具体内容）_  ← 链接到设计文档
```

## 示例对比

### 优化前

```markdown
- [ ] 8. 实现 ScriptWriter Agent
  - 集成 LLM API（OpenAI/Claude）
  - 实现剧本生成逻辑
  - 实现 shot 分解算法
  - 实现情绪标注
  - 实现 SCENE_WRITTEN 事件发布
  - 实现重写机制（最多 3 次）
  - _Requirements: 1.1, 1.2_
```

### 优化后

```markdown
- [ ] 8. 实现 ScriptWriter Agent
  - 集成 LLM API（OpenAI/Claude）
  - 实现剧本生成逻辑
  - 实现 shot 分解算法
  - 实现情绪标注
  - 实现 SCENE_WRITTEN 事件发布
  - 实现重写机制（最多 3 次）
  - _Requirements: 1.1, 1.2_
  - _Design: Components > 3. ScriptWriter Agent（包含用户审批处理）_
```

## 设计文档章节映射

### Phase 1: 核心基础设施

| 任务 | 设计文档引用 |
|------|-------------|
| 1. Shared Blackboard | Architecture > 1. Shared Blackboard（共享黑板） |
| 2. Event Bus | Architecture > 2. Event Bus（事件总线） |
| 3. Orchestrator | Architecture > 3. Task vs Event 关系模型, Components > 13. Orchestrator |
| 4. Storage Service | Architecture > 1. Shared Blackboard（artifact_index 部分） |
| 5. ModelRouter | Components > 14. ModelRouter（基础设施） |

### Phase 2: 核心 Agent

| 任务 | 设计文档引用 |
|------|-------------|
| 6. RequirementParser | Components > 2. RequirementParser Agent |
| 7. ChefAgent | Components > 1. ChefAgent（总监 Agent） |
| 8. ScriptWriter | Components > 3. ScriptWriter Agent（包含用户审批处理） |
| 9. ShotDirector | Components > 4. ShotDirector Agent |
| 10. PromptEngineer | Components > 6. PromptEngineer Agent（包含模板库结构） |

### Phase 3: 生成 Agent 与 Adapter

| 任务 | 设计文档引用 |
|------|-------------|
| 11. Adapter 接口 | Components > 14. ModelRouter（Adapter 接口定义部分） |
| 12. ImageGen + SDXL | Components > 7. ImageGen Agent |
| 13. VideoGen + Runway | Components > 8. VideoGen Agent |
| 14. Audio Strategy | Components > 8. VideoGen Agent（Audio Strategy 决策表） |
| 15. MusicComposer | Components > 9. MusicComposer Agent |
| 16. VoiceActor | Components > 10. VoiceActor Agent |

### Phase 4: QA 与一致性

| 任务 | 设计文档引用 |
|------|-------------|
| 17. ArtDirector | Components > 5. ArtDirector Agent（包含 DNA 合并策略） |
| 18. QA - 视觉检测 | Components > 12. ConsistencyGuardian（run_qa_checks, get_dynamic_thresholds） |
| 19. QA - 跨 Shot | Components > 12. ConsistencyGuardian（check_shot_continuity） |
| 20. QA - 音频检测 | Components > 12. ConsistencyGuardian（音频检测部分） |
| 21. 自动修复 | Components > 12. ConsistencyGuardian（auto_fix）, Error Handling > 三层错误恢复策略 |

### Phase 5: Editor 与输出

| 任务 | 设计文档引用 |
|------|-------------|
| 22. 视频拼接 | Components > 11. Editor Agent（assemble_final_video） |
| 23. 音频混合 | Components > 11. Editor Agent（mix_audio, sync_audio_to_video） |
| 24. 最终输出 | Components > 11. Editor Agent（assemble_final_video 返回值） |

### Phase 6: 用户审批与监控

| 任务 | 设计文档引用 |
|------|-------------|
| 25. 审批机制 | Data Models > ApprovalRequest, Components > 13. Orchestrator（审批相关方法） |
| 26. Agent 审批处理 | Components > 3. ScriptWriter Agent（handle_user_revision） |
| 27. 审批 UI | Data Models > ApprovalRequest, Architecture > 2. Event Bus（审批事件） |
| 28. 自动模式切换 | Data Models > Project 扩展（user_options） |
| 29. HumanGate | Error Handling > Level 3: 人工介入 |
| 30. 成本控制 | Components > 1. ChefAgent（预算相关）, Architecture > 1. Shared Blackboard（budget） |
| 31. 监控 | Architecture > 2. Event Bus（链路追踪）, Error Handling > 错误日志与追溯 |

### Phase 7-10: 测试、高级功能、UI、部署

所有任务都已添加对应的设计文档引用，涵盖：
- 测试策略章节
- 高级 Adapter 实现
- UI 数据模型
- 部署技术选型

## 使用方法

### 对于开发人员

1. **查看任务**: 在 `tasks.md` 中找到要实现的任务
2. **查看需求**: 通过 `_Requirements:` 行了解业务需求
3. **查看设计**: 通过 `_Design:` 行找到详细的技术设计
4. **实现代码**: 根据设计文档中的代码示例和说明进行开发

### 示例工作流程

假设开发人员要实现 "任务 8: ScriptWriter Agent"：

```
1. 打开 tasks.md，找到任务 8
   ↓
2. 查看 Requirements: 1.1, 1.2
   → 打开 requirements.md，阅读 Requirement 1（文档统一与架构清晰）
   ↓
3. 查看 Design: Components > 3. ScriptWriter Agent
   → 打开 design.md，搜索 "3. ScriptWriter Agent"
   ↓
4. 阅读设计文档中的：
   - 职责说明
   - 输入/输出事件
   - 核心能力代码示例（generate_script, handle_user_revision）
   - 失败策略
   ↓
5. 基于设计文档中的代码示例开始实现
   ↓
6. 参考 Testing Strategy 章节编写单元测试
```

## 优势

### 1. 提高开发效率
- 开发人员无需在多个文档间反复搜索
- 直接定位到相关的设计章节
- 减少理解成本

### 2. 确保实现一致性
- 所有开发人员参考同一份设计文档
- 避免各自理解导致的实现差异
- 代码风格和架构保持统一

### 3. 便于代码审查
- 审查人员可以快速对照设计文档
- 验证实现是否符合设计意图
- 发现偏离设计的问题

### 4. 降低维护成本
- 新成员快速了解系统设计
- 修改功能时能找到完整的上下文
- 文档和代码保持同步

## 文档结构

```
.kiro/specs/unified-agent-system-design/
├── requirements.md          ← 业务需求（11 个 Requirement）
├── design.md               ← 技术设计（详细的实现指导）
└── tasks.md                ← 实施任务（44 个任务，现已添加设计引用）
```

## 注意事项

1. **保持同步**: 如果修改 design.md 的章节结构，需要同步更新 tasks.md 中的引用
2. **精确引用**: 引用的章节名称必须与 design.md 中的标题完全一致
3. **多章节引用**: 如果任务涉及多个设计章节，用逗号分隔（如任务 3）
4. **具体内容标注**: 在括号中标注具体的方法名或内容，帮助快速定位

## 后续建议

1. **IDE 集成**: 可以考虑在 IDE 中添加快捷跳转功能
2. **自动化检查**: 编写脚本验证引用的章节是否存在
3. **版本控制**: 在 design.md 修改时，自动检查 tasks.md 的引用是否需要更新
4. **交叉引用**: 考虑在 design.md 中也添加反向引用，指向使用该设计的任务

---

**优化完成日期**: 2025-11-16  
**文档版本**: v2.2  
**影响范围**: tasks.md 中的所有 44 个任务
